<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <style>
        .soter-wrap{
            text-align: center;
            margin: 200px 0 50px 0;
        }
        .soter-title{
            font-weight: bold;
            font-size: 30px;
        }
        .soter-description{
            font-size: 16px;
        }
        .soter-button{
            text-align: center;
            margin: 50px 0 50px 0;
        }
    </style>
</head>
<body>
<div id="app">
    <div class="soter-wrap">
    <h1 class="soter-title">Get 1000 test coins</h1>
    <p class="soter-description">Test currency can be obtained by entering account address</p>
    </div>
    <form id="token" class="form-horizontal">
        <div class="form-group">
            <label for="text" class="col-sm-2 control-label">Account Address</label>
            <div class="col-sm-9">
                <input type="text" class="form-control" id="address" v-model="address">
            </div>
        </div>

        <div class="soter-button">
            <el-button type="primary" :loading="load" @Click="getToken">{{buttonName}}</el-button>
        </div>
    </form>
</div>

</body>

<!-- import Vue before Element -->
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<!-- import JavaScript -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script src="https://cdn.bootcss.com/axios/0.19.0/axios.min.js"></script>

<script>
    const TIME_COUNT = 60;
    new Vue({
        el: '#app',
        data: {
            address: '',
            load: false,
            count: 60,
            timer: null,
            buttonName: 'Obtain'
        },
        methods: {
            getCode(){
                if (!this.timer) {
                    this.count = TIME_COUNT;
                    this.load = true;
                    this.timer = setInterval(() => {
                        if (this.count > 0 && this.count <= TIME_COUNT) {
                            this.buttonName = `Wait ${this.count--}s`;
                            console.log( this.buttonName)
                        } else {
                            clearInterval(this.timer);
                            this.timer = null;
                            this.load = false;
                            this.buttonName = 'Obtain'
                        }
                    }, 1000)
                }
            },
            getToken() {
                const _this = this;

                if (_this.address === ''){
                    _this.$message.error('Account address cannot be empty!');
                    return
                }

                let formData = new FormData();
                formData.append("address", this.address);

                axios.post("api/v0/transfer",formData).then(function (response) {
                    if (response.status === 200 && response.data.code === 0){
                        _this.$message({
                            message: 'Get test token success, please wait and check!',
                            type: 'success'
                        });
                        _this.getCode();
                    } else{
                        _this.$message.error(response.data.message);
                    }
                }).catch(function (error) {
                    _this.$message.error(error);
                });
            }
        }
    });
</script>
</html>
